<!DOCTYPE html>
<html>
<head>
    <title>
        Telepresence Control
    </title>
</head>
<body onkeydown="keyDown(event)" onkeyup="keyUp(event)">
    <style>
        html, body {margin: 0; height: 100%; overflow: hidden}
        .row {
            display: flex;
            height: 33vh;
        }

        .column {
            flex: 50%;
            padding: 10px;
        }

        .control {
            height: 100%;
            width: 100%;
        }

        #main {
            height: 100vh
        }
    </style>
    <div id="main">
        <div class="row">
            <div class="column">
                <button class="control" id="turnLeft" onmousedown="buttonDown(this.id)" onmouseup="buttonUp(this.id)">
                    Turn left
                </button>
            </div>
            <div class="column">
                <button class="control" id="forward" onmousedown="buttonDown(this.id)" onmouseup="buttonUp(this.id)">
                    Forward
                </button>
            </div>
            <div class="column">
                <button class="control" id="turnRight" onmousedown="buttonDown(this.id)" onmouseup="buttonUp(this.id)">
                    Turn right
                </button>
            </div>
        </div>
        <div class="row">
            <div class="column">
                <button class="control" id="left" onmousedown="buttonDown(this.id)" onmouseup="buttonUp(this.id)">
                    Left
                </button>
            </div>
            <div class="column">
            </div>
            <div class="column">
                <button class="control" id="right" onmousedown="buttonDown(this.id)" onmouseup="buttonUp(this.id)">
                    Right
                </button>
            </div>
        </div>
        <div class="row">
            <div class="column">
            </div>
            <div class="column">
                <button class="control" id="backward" onmousedown="buttonDown(this.id)" onmouseup="buttonUp(this.id)">
                    Backward
                </button>
            </div>
            <div class="column">
            </div>
        </div>
    </div>
    <script>
        function buttonDown(btn) {
            console.log("D " + btn);
            const speed = 255;
            switch (btn) {
                case "forward":
                    send(0, 0, speed);
                    break;
            
                case "backward":
                    send(0, 1, speed);
                    break;
                
                case "left":
                    send(1, 0, speed);
                    break;
                
                case "right":
                    send(1, 1, speed);
                    break;
                
                case "turnLeft":
                    send(2, 0, speed);
                    break;
                
                case "turnRight":
                    send(2, 1, speed);
                    break;
                
                default:
                    break;
            }
        }
        function buttonUp(btn) {
            console.log("U " + btn);
            send(0, 0, 0);
        }
        function send(axis, direction, speed) {
            fetch("http://raspberrypi.local/control?axis=" + axis + "&direction=" + direction + "&speed=" + speed)
            .then(response => response.text())
            .then(body => console.log(body));
        }
        function keyDown(e) {
            switch (e.key) {
                case "ArrowUp":
                    buttonDown("forward");
                    break;
            
                case "ArrowDown":
                    buttonDown("backward");
                    break;
            
                case "ArrowLeft":
                    buttonDown("left");
                    break;
            
                case "ArrowRight":
                    buttonDown("right");
                    break;
            
                default:
                    break;
            }
        }
        function keyUp(e) {
            switch (e.key) {
                case "ArrowUp":
                case "ArrowDown":
                case "ArrowLeft":
                case "ArrowRight":
                    buttonUp("key");
                    break;
            
                default:
                    break;
            }
        }
    </script>
</body>
</html>
